---
layout: default
navtitle: Subs-Package.php
title: ./Sources/Subs-Package.php
count: 30
---

### read_tgz_file

```php
function read_tgz_file($gzfilename, $destination, $single_file = false, $overwrite = false, $files_to_extract = null)
```
Reads a .tar.gz file, filename, in and extracts file(s) from it.

essentially just a shortcut for read_tgz_data().

Type|Parameter|Description
---|---|---
```php string```|```php $gzfilename```|The path to the tar.gz file
```php string```|```php $destination```|The path to the desitnation directory
```php bool```|```php $single_file```|If true returns the contents of the file specified by destination if it exists
```php bool```|```php $overwrite```|Whether to overwrite existing files
```php null&#124;array```|```php $files_to_extract```|Specific files to extract

### read_tgz_data

```php
function read_tgz_data($gzfilename, $destination, $single_file = false, $overwrite = false, $files_to_extract = null)
```
Extracts a file or files from the .tar.gz contained in data.

detects if the file is really a .zip file, and if so returns the result of read_zip_data

if destination is null
- returns a list of files in the archive.

if single_file is true
- returns the contents of the file specified by destination, if it exists, or false.
- destination can start with * and / to signify that the file may come from any directory.
- destination should not begin with a / if single_file is true.

overwrites existing files with newer modification times if and only if overwrite is true.
creates the destination directory if it doesn't exist, and is is specified.
requires zlib support be built into PHP.
returns an array of the files extracted.
if files_to_extract is not equal to null only extracts file within this array.

Type|Parameter|Description
---|---|---
```php string```|```php $gzfilename```|The name of the file
```php string```|```php $destination```|The destination
```php bool```|```php $single_file```|Whether to only extract a single file
```php bool```|```php $overwrite```|Whether to overwrite existing data
```php null&#124;array```|```php $files_to_extract```|If set, only extracts the specified files

### read_zip_file

```php
function read_zip_file($file, $destination, $single_file = false, $overwrite = false, $files_to_extract = null)
```
Extract zip data. A functional copy of {@list read_zip_data()}.



Type|Parameter|Description
---|---|---
```php string```|```php $file```|Input filename
```php string```|```php $destination```|Null to display a listing of files in the archive, the destination for the files in the archive or the name of a single file to display (if $single_file is true)
```php bool```|```php $single_file```|If true, returns the contents of the file specified by destination or false if the file can't be found (default value is false).
```php bool```|```php $overwrite```|If true, will overwrite files with newer modication times. Default is false.
```php array```|```php $files_to_extract```|Specific files to extract

### read_zip_data

```php
function read_zip_data($data, $destination, $single_file = false, $overwrite = false, $files_to_extract = null)
```
Extract zip data. .

If single_file is true, destination can start with * and / to signify that the file may come from any directory.
Destination should not begin with a / if single_file is true.

Type|Parameter|Description
---|---|---
```php string```|```php $data```|ZIP data
```php string```|```php $destination```|Null to display a listing of files in the archive, the destination for the files in the archive or the name of a single file to display (if $single_file is true)
```php bool```|```php $single_file```|If true, returns the contents of the file specified by destination or false if the file can't be found (default value is false).
```php bool```|```php $overwrite```|If true, will overwrite files with newer modication times. Default is false.
```php array```|```php $files_to_extract```|

### url_exists

```php
function url_exists($url)
```
Checks the existence of a remote file since file_exists() does not do remote.

will return false if the file is "moved permanently" or similar.

Type|Parameter|Description
---|---|---
```php string```|```php $url```|The URL to parse

### loadInstalledPackages

```php
function loadInstalledPackages()
```
Loads and returns an array of installed packages.

default sort order is package_installed time

### getPackageInfo

```php
function getPackageInfo($gzfilename)
```
Loads a package's information and returns a representative array.

- expects the file to be a package in Packages/.
- returns a error string if the package-info is invalid.
- otherwise returns a basic array of id, version, filename, and similar information.
- an xmlArray is available in 'xml'.

Type|Parameter|Description
---|---|---
```php string```|```php $gzfilename```|The path to the file

### create_chmod_control

```php
function create_chmod_control($chmodFiles = array(), $chmodOptions = array(), $restore_write_status = false)
```
Create a chmod control for chmoding files.



Type|Parameter|Description
---|---|---
```php array```|```php $chmodFiles```|Which files to chmod
```php array```|```php $chmodOptions```|Options for chmod
```php bool```|```php $restore_write_status```|Whether to restore write status

### packageRequireFTP

```php
function packageRequireFTP($destination_url, $files = null, $return = false)
```
Use FTP functions to work with a package download/install



Type|Parameter|Description
---|---|---
```php string```|```php $destination_url```|The destination URL
```php null&#124;array```|```php $files```|The files to CHMOD
```php bool```|```php $return```|Whether to return an array of file info if there's an error

### parsePackageInfo

```php
function parsePackageInfo(&$packageXML, $testing_only = true, $method = 'install', $previous_version = '')
```
Parses the actions in package-info.xml file from packages.

- package should be an xmlArray with package-info as its base.
- testing_only should be true if the package should not actually be applied.
- method can be upgrade, install, or uninstall.  Its default is install.
- previous_version should be set to the previous installed version of this package, if any.
- does not handle failure terribly well; testing first is always better.

Type|Parameter|Description
---|---|---
```php \xmlArray```|```php &$packageXML```|The info from the package-info file
```php bool```|```php $testing_only```|Whether we're only testing
```php string```|```php $method```|The method ('install', 'upgrade', or 'uninstall')
```php string```|```php $previous_version```|The previous version of the mod, if method is 'upgrade'

### matchHighestPackageVersion

```php
function matchHighestPackageVersion($versions, $reset = false, $the_version)
```
Checks if version matches any of the versions in versions.

- supports comma separated version numbers, with or without whitespace.
- supports lower and upper bounds. (1.0-1.2)
- returns true if the version matched.

Type|Parameter|Description
---|---|---
```php string```|```php $versions```|The SMF versions
```php bool```|```php $reset```|Whether to reset $near_version
```php string```|```php $the_version```|

### matchPackageVersion

```php
function matchPackageVersion($version, $versions)
```
Checks if the forum version matches any of the available versions from the package install xml.

- supports comma separated version numbers, with or without whitespace.
- supports lower and upper bounds. (1.0-1.2)
- returns true if the version matched.

Type|Parameter|Description
---|---|---
```php string```|```php $version```|The forum version
```php string```|```php $versions```|The versions that this package will install on

### compareVersions

```php
function compareVersions($version1, $version2)
```
Compares two versions and determines if one is newer, older or the same, returns
- (-1) if version1 is lower than version2
- (0) if version1 is equal to version2
- (1) if version1 is higher than version2



Type|Parameter|Description
---|---|---
```php string```|```php $version1```|The first version
```php string```|```php $version2```|The second version

### parse_path

```php
function parse_path($path)
```
Parses special identifiers out of the specified path.



Type|Parameter|Description
---|---|---
```php string```|```php $path```|The path

### deltree

```php
function deltree($dir, $delete_dir = true)
```
Deletes a directory, and all the files and direcories inside it.

requires access to delete these files.

Type|Parameter|Description
---|---|---
```php string```|```php $dir```|A directory
```php bool```|```php $delete_dir```|If false, only deletes everything inside the directory but not the directory itself

### mktree

```php
function mktree($strPath, $mode)
```
Creates the specified tree structure with the mode specified.

creates every directory in path until it finds one that already exists.

Type|Parameter|Description
---|---|---
```php string```|```php $strPath```|The path
```php int```|```php $mode```|The permission mode for CHMOD (0666, etc.)

### copytree

```php
function copytree($source, $destination)
```
Copies one directory structure over to another.

requires the destination to be writable.

Type|Parameter|Description
---|---|---
```php string```|```php $source```|The directory to copy
```php string```|```php $destination```|The directory to copy $source to

### listtree

```php
function listtree($path, $sub_path = '')
```
Create a tree listing for a given directory path



Type|Parameter|Description
---|---|---
```php string```|```php $path```|The path
```php string```|```php $sub_path```|The sub-path

### parseModification

```php
function parseModification($file, $testing = true, $undo = false, $theme_paths = array())
```
Parses a xml-style modification file (file).



Type|Parameter|Description
---|---|---
```php string```|```php $file```|The modification file to parse
```php bool```|```php $testing```|Whether we're just doing a test
```php bool```|```php $undo```|If true, specifies that the modifications should be undone. Used when uninstalling. Doesn't work with regex.
```php array```|```php $theme_paths```|An array of information about custom themes to apply the changes to

### parseBoardMod

```php
function parseBoardMod($file, $testing = true, $undo = false, $theme_paths = array())
```
Parses a boardmod-style (.mod) modification file



Type|Parameter|Description
---|---|---
```php string```|```php $file```|The modification file to parse
```php bool```|```php $testing```|Whether we're just doing a test
```php bool```|```php $undo```|If true, specifies that the modifications should be undone. Used when uninstalling.
```php array```|```php $theme_paths```|An array of information about custom themes to apply the changes to

### package_get_contents

```php
function package_get_contents($filename)
```
Get the physical contents of a packages file



Type|Parameter|Description
---|---|---
```php string```|```php $filename```|The package file

### package_put_contents

```php
function package_put_contents($filename, $data, $testing = false)
```
Writes data to a file, almost exactly like the file_put_contents() function.

uses FTP to create/chmod the file when necessary and available.
uses text mode for text mode file extensions.
returns the number of bytes written.

Type|Parameter|Description
---|---|---
```php string```|```php $filename```|The name of the file
```php string```|```php $data```|The data to write to the file
```php bool```|```php $testing```|Whether we're just testing things

### package_flush_cache

```php
function package_flush_cache($trash = false)
```
Flushes the cache from memory to the filesystem



Type|Parameter|Description
---|---|---
```php bool```|```php $trash```|

### package_chmod

```php
function package_chmod($filename, $perm_state = 'writable', $track_change = false)
```
Try to make a file writable.



Type|Parameter|Description
---|---|---
```php string```|```php $filename```|The name of the file
```php string```|```php $perm_state```|The permission state - can be either 'writable' or 'execute'
```php bool```|```php $track_change```|Whether to track this change

### package_crypt

```php
function package_crypt($pass)
```
Used to crypt the supplied ftp password in this session



Type|Parameter|Description
---|---|---
```php string```|```php $pass```|The password

### package_create_backup

```php
function package_create_backup($id = 'backup')
```
Creates a backup of forum files prior to modifying them



Type|Parameter|Description
---|---|---
```php string```|```php $id```|The name of the backup

### smf_crc32

```php
function smf_crc32($number)
```
crc32 doesn't work as expected on 64-bit functions - make our own.

https://php.net/crc32#79567

Type|Parameter|Description
---|---|---
```php string```|```php $number```|

### package_validate_installtest

```php
function package_validate_installtest($package)
```
Validate a package during install



Type|Parameter|Description
---|---|---
```php array```|```php $package```|Package data

### package_validate

```php
function package_validate($packages)
```
Validate multiple packages.



Type|Parameter|Description
---|---|---
```php array```|```php $packages```|Package data

### package_validate_send

```php
function package_validate_send($sendData)
```
Sending data off to validate packages.



Type|Parameter|Description
---|---|---
```php array```|```php $sendData```|Json encoded data to be sent to the validation servers.

